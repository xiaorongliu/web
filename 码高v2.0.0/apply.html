<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>码高研学</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <script type='text/javascript' src='js/zepto.min.js' charset='utf-8'></script>
  <script type='text/javascript' src='js/sm.min.js' charset='utf-8'></script>
  <link rel="stylesheet" href="./css/sm.min.css">
  <link rel="stylesheet" href="./css/mian.css">
  <link rel="stylesheet" href="./css/apply.css">
</head>
<script>
</script>

<body>
  <div class="page-group">
    <div id="page-picker" class="page page-current">
      <header class="bar bar-nav header">
        <button class="button pull-left city">北京<span class="icon icon-down"></span></button>
        <div class="address">
          <p class="succee">已开通城市</p>
          <a href="#">全国</a>
          <a href="#">北京</a>
          <p class="moreCity">更多城市即将开通</p>
        </div>
        <h1 class="title">
          <a href="#"><img src="./images/logo.png" alt=""></a>
        </h1>
        <span class="icon icon-menu pull-right"></span>
        <div class="menu">
          <a href="./index.html"><i></i>首 页</a>
          <a href="./enroll.html"><i></i>注 册</a>
          <a href="./order form.html"><i></i>订 单</a>
          <a href="./personal-center.html"><i></i>我 的</a>
          <a href="./login.html"><i></i>退 出</a>
        </div>
      </header>
      <div class="content" id="applyContent">
        <div class="apply-items">
          <!-- 购买信息 -->
          <div class="apply-item">
            <div class="apply-title"> 码高科技-周末营《无人机》
              <span class="apply-people">报名人数&nbsp;<i id="ap-reduce">-</i><i id="ap-number">1</i><i id="ap-plus">+</i>
          </span>
            </div>
            <div class="apply-word">
              第三期(2017年07月23日) <span class="price">￥<span class="priceNum">880.00</span></span>
            </div>
            <i class="apply-check"></i>
          </div>

          <!-- 购买信息 结束 -->

        </div>
        <div id="apply-info">
          <!-- 点击确定 页面弹出 学员基本信息-->
          <!-- 学员一 -->
          <div class="sureMsg sureMsgOne">
            <div class="sure-name"></div>年龄:<span class="sure-age"></span>岁
            <div class="sure-sure"><i class="sure-sure-gou"></i>&nbsp;<i class="sure-sure-cha"></i></div>
          </div>
          <!--学院二  -->
          <div class="sureMsg sureMsgTwo">
            <div class="sure-name"></div>年龄:<span class="sure-age"></span>岁
            <div class="sure-sure"><i class="sure-sure-gou"></i>&nbsp;<i class="sure-sure-cha"></i></div>
          </div>

          <!-- 点击确定 页面弹出 学员基本信息 结束-->
        </div>
        <div class="studentMsg">
          <div class="buttons-tab">
            <a href="#tab1" class="tab-link active stMsg">学员信息</a>
            <a href="#tab2" class="tab-link hidden">学员二信息</a>
          </div>
          <div class="tabs">
            <div id="tab1" class="tab active">
              <!-- 学员1 填写基本信息 -->
              <div class="formMsg">
                <p><span>姓名：</span><input class="input-name" type="text" placeholder="请输入真实姓名"></p>
                <p><span>性别：</span><select class="select input-sex">
                    <option value="男">男</option>
                    <option value="女">女</option>
                  </select>
                  <span class="icon icon-right input-sex-icon"></span>
                </p>
                <p><span>年龄：</span><input class="input-age" type="number" type="number" maxlength="2"><span class="icon icon-right input-age-icon"></span></p>
                <p><span>证件类型：</span><select class="select input-type">
                    <option>身份证</option>
                  </select><span class="icon icon-right input-type-icon"></span></p>
                <p><span>身份证号：</span><input class="input-number" type="text" placeholder="请输入真实身份证号"></p>
              </div>

              <!-- 学员1 填写基本信息 结束-->
            </div>
            <div id="tab2" class="tab">
              <div class="formMsg">
                <p><span>姓名：</span><input id="picker" class="input-name" type="text" placeholder="请输入真实姓名"></p>
                <p><span>性别：</span><select class="select input-sex">
                    <option>男</option>
                    <option>女</option>
                  </select>
                  <span class="icon icon-right input-sex-icon"></span>
                </p>
                <p><span>年龄：</span><input class="input-age" type="number" maxlength="2"><span class="icon icon-right input-age-icon"></span></p>
                <p><span>证件类型：</span><select class="select input-type">
                    <option>身份证</option>
                  </select><span class="icon icon-right input-type-icon"></span></p>
                <p><span>身份证号：</span><input class="input-number" type="text" placeholder="请输入真实身份证号"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="applySure"><a href="#" class="button button-fill"> 确 定 </a></div>
        <div class="applyContacts">
          <p>联系人信息</p>
          <div class="formMsg">
            <p><span>姓名：</span><input class="applyContacts-name" type="text" placeholder="请输入真实姓名"></p>
            <p><span>手机号：</span><input type="number" maxlength="11">
              <p><span>与宝宝关系:</span><input class="applyContacts-baby" type="text"></p>
          </div>
        </div>
        <div class="applyRemark">
          <p>备注</p>
          <textarea placeholder="请输入您的特殊要求或其他需要我们注意宝宝的信息，谢谢~"></textarea>
        </div>
        <p class="applyAgree">
          <input type="checkbox" id="applyCheck" checked>
          <label for="applyCheck">已阅读并同意</label>
          <a href="javascript:;">使用条款及隐私政策</a>
        </p>
      </div>
      <div class="applyApply">
        <div class="total-value">
          总价:<span>￥<span class="total-value-num">880</span></span>
        </div>
        <div class="apply-Pay">
          支&nbsp;付
        </div>
      </div>
    </div>
  </div>
</body>
<script src="js/main.js"></script>

<script>
  // 获取地址
  //  var substr = document.URL;
  // 获取地址传递参数( 商品信息 )
  // function GetQueryString(name) {
  //   var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
  //   var r = window.location.search.substr(1).match(reg);
  //   if (r != null) return unescape(r[2]);
  //   return null;
  // }
  // var good1 = GetQueryString("keywords"); //详情页信息 
  // var good = decodeURI(good1);
  // 传入后台
  // $.ajax({
  //   type: "get",
  //   url: "",
  //   dataType: "json",
  //   success: function(data) {
  //     console.log(data)
  //  
  //   返回数据
  //  `<div class="apply-item">
  //   <div class="apply-title"> 码高科技-周末营《无人机》
  //     <span class="apply-people">报名人数&nbsp;<i id="ap-reduce">-</i><i id="ap-number">1</i><i id="ap-plus">+</i>
  // </span>
  //   </div>
  //   <div class="apply-word">
  //     第三期(2017年07月23日) <span class="price">￥<span class="priceNum">880.00</span></span>
  //   </div>
  //   <i class="apply-check"></i>
  // </div>`
  //   添加到 $(".apply-items").html()中
  //   }
  // })





  var reduce = $("#ap-reduce")
  var number = $("#ap-number")
  var plus = $("#ap-plus")
  var price = $(".priceNum").html()
  var sum = 0;
  var stMsg = $(".stMsg")
  var hidden = $(".hidden")
  var applySure = $(".applySure>a")
  var total = $(".total-value-num")

  function reduceclick() {
    stMsg.html(`学员信息`)
    hidden.css("display", "none")
    reduce.css({
      'backgroundColor': 'f7f7f7',
      'borderColor': '#ebebeb',
      'color': '#ababab'
    })
  }


  function getMessage(name, sex, age, zhen, num) {
    $.ajax({
      type: 'post',
      url: "",
      beforeSend: function() {
        re.setRequestHeader('token', localStorage.token)
      },
      contentType: "application/x-www-form-urlencoded",
      data: {
        name: name, // 名字
        sex: sex, //性别
        age: age, // 年龄
        zhen: zhen, // 身份证
        num: num // 证件号码
      },
      dataType: "json",
      success: function(data) {
        console.log(data)
      },
      error: function(data) {
        console.log(data)
      }
    })
  }

  $(reduce).click(function() {
    var a = number.html()
    if (a <= 1) {
      return
    }
    a--;
    a == 1 ? reduceclick() : a;
    sum = sum - price;
    number.html(a)
    $(".sureMsgTwo").css("display", "none")
    total.html(sum.toFixed(2))
    $(".priceNum").html(sum.toFixed(2))
    console.log(number.html())
  })

  $(plus).click(function() {
    reduce.css({
      'backgroundColor': '#fff',
      'borderColor': '#ababab',
      'borderRight': 0,
      'color': '#717171'
    })
    hidden.css("display", "inline-block")
    stMsg.html(`学员一信息`)
    var b = number.html()
    b++;
    if (b >= 3) {
      alert("已经达到人数上限")
      return
    }
    sum = b * price;
    total.html(sum.toFixed(2))
    $(".priceNum").html(sum.toFixed(2))
    number.html(b)
  })


  applySure.click(function() {

    var inName = $("#tab1 .input-name").val()
    var inSex = $("#tab1 .input-sex").val()
    var inAge = $("#tab1 .input-age").val()
    var inType = $("#tab1 .input-type").val()
    var inNumber = $("#tab1 .input-number").val()
    if ($("#tab1").css("display") == "block") {
      if ($(".sureMsgOne").css("display") == "block") {
        return
      }
      if (inName && inSex && inAge && inType && inNumber) {
        $(".sureMsgOne .sure-name").html(inName + '&nbsp;<i class="sure-name-sex">' + inSex + '</i>')
        $(".sureMsgOne .sure-age").html(inAge);
        $(".sureMsgOne").css("display", "block")
          /* 
          // ajax 传入学员 1 数据

          getMessage(inName,inSex,inAge,inType,inNumber)
          
           */
      } else {
        alert("表中信息未填全")
        console.log(123)
      }
    }
    if ($("#tab2").css("display") == "block") {
      if ($(".sureMsgTwo").css("display") == "block") {
        return
      }
      var inNameTwo = $("#tab2 .input-name").val()
      var inSexTwo = $("#tab2 .input-sex").val()
      var inAgeTwo = $("#tab2 .input-age").val()
      var inTypeTwo = $("#tab2 .input-type").val()
      var inNumberTwo = $("#tab2 .input-number").val()
      if (inNameTwo && inSexTwo && inAgeTwo && inTypeTwo && inNumberTwo) {
        $(".sureMsgTwo .sure-name").html(inNameTwo + '&nbsp;<i class="sure-name-sex">' + inSexTwo + '</i>')
        $(".sureMsgTwo .sure-age").html(inAgeTwo);
        $(".sureMsgTwo").css("display", "block")
          /* 
          
    // ajax 传入如果有学员2  则传入 学员2 数据 
        getMessage(inNameTwo,inSexTwo,inAgeTwo,inTypeTwo,inNumberTwo)
           */
      } else {
        alert("表中信息未填全")
        console.log(123)
      }
    }
  });
  $(".sure-sure-cha").click(function() {
    console.log($(this).parent().parent())
    $(this).parent().parent().css("display", "none")
  })




  /* 点击支付*/
  $(".apply-Pay").click(function() {


    if (!$(".applyContacts").val() && !$(".applyContacts-baby")) {
      alert("请填写联系人信息")
      return
    }




    /* 微信支付流程信息 */
    function onBridgeReady() {

      WeixinJSBridge.invoke(
        'getBrandWCPayRequest',


        // 支付所需要信息
        {
          "appId": "wx2421b1c4370ec43b", //公众号名称，由商户传入     
          "timeStamp": "1395712654", //时间戳，自1970年以来的秒数     
          "nonceStr": "e61463f8efa94090b1f366cccfbbb444", //随机串     
          "package": "prepay_id=u802345jgfjsdfgsdg888",
          "signType": "MD5", //微信签名方式：     
          "paySign": "70EA570631E4BB79628FBCA90534C63FF7FADD89" //微信签名 
        }


        ,
        function(res) {
          if (res.err_msg == "get_brand_wcpay_request:ok") {} // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。 
        }
      );
    }
    if (typeof WeixinJSBridge == "undefined") {
      if (document.addEventListener) {
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
      } else if (document.attachEvent) {
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
      }
    } else {
      onBridgeReady();
    }

  })
</script>

</html>